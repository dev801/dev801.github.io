<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding favicon -->
    
    <link rel="icon" href="https://george-801.github.io/webstuff/lgRed.png" />
    

    <!-- Adding meta -->
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      LanguageHandler.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-dark.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Home</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><div class="accordion collapsed" id="5304980" > <h3 class="accordion-heading">Classes<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion collapsed child" id=2577616><div class="accordion-heading child"><a href="CommandHandler.html">CommandHandler</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="CommandHandler.html#.addCommandDirectory">addCommandDirectory</a></li><li data-type='method'><a href="CommandHandler.html#.attachClient">attachClient</a></li><li data-type='method'><a href="CommandHandler.html#.removeCommandDirectory">removeCommandDirectory</a></li></ul></li><li class="accordion collapsed child" id=5402117><div class="accordion-heading child"><a href="LanguageHandler.html">LanguageHandler</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="LanguageHandler.html#.addLanguageFolder">addLanguageFolder</a></li><li data-type='method'><a href="LanguageHandler.html#.getLocalisation">getLocalisation</a></li><li data-type='method'><a href="LanguageHandler.html#.loadAllLanguages">loadAllLanguages</a></li><li data-type='method'><a href="LanguageHandler.html#.loadLanguageFile">loadLanguageFile</a></li></ul></li><li class="accordion collapsed child" id=3320958><div class="accordion-heading child"><a href="LoggingHandler.html">LoggingHandler</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="LoggingHandler.html#.createLogger">createLogger</a></li></ul></li></ul> </div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        LanguageHandler.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

const { Collection } = require("discord.js");
const { isAbsolute, normalize, join, basename, extname } = require("path");
const { existsSync, statSync, readdirSync, readFileSync } = require("fs");

/**
 * @typedef {Object} Language A set of language data.
 * @property {ISOLangCode} id The language's ISO 639-1 code.
 * @property {Object} data All translations.
 */

/**
 * @typedef {'aa'|'ab'|'ae'|'af'|'ak'|'am'|'an'|'ar'|'as'|'av'|'ay'|'az'|'ba'|'be'|'bg'|'bh'|'bm'|'bi'|'bn'|'bo'|'br'|'bs'|'ca'|'ce'|'ch'|'co'|'cr'|'cs'|'cu'|'cv'|'cy'|'da'|'de'|'dv'|'dz'|'ee'|'el'|'en'|'eo'|'es'|'et'|'eu'|'fa'|'ff'|'fi'|'fj'|'fo'|'fr'|'fy'|'ga'|'gd'|'gl'|'gn'|'gu'|'gv'|'ha'|'he'|'hi'|'ho'|'hr'|'ht'|'hu'|'hy'|'hz'|'ia'|'id'|'ie'|'ig'|'ii'|'ik'|'io'|'is'|'it'|'iu'|'ja'|'jv'|'ka'|'kg'|'ki'|'kj'|'kk'|'kl'|'km'|'kn'|'ko'|'kr'|'ks'|'ku'|'kv'|'kw'|'ky'|'la'|'lb'|'lg'|'li'|'ln'|'lo'|'lt'|'lu'|'lv'|'mg'|'mh'|'mi'|'mk'|'ml'|'mn'|'mr'|'ms'|'mt'|'my'|'na'|'nb'|'nd'|'ne'|'ng'|'nl'|'nn'|'no'|'nr'|'nv'|'ny'|'oc'|'oj'|'om'|'or'|'os'|'pa'|'pi'|'pl'|'ps'|'pt'|'qu'|'rm'|'rn'|'ro'|'ru'|'rw'|'sa'|'sc'|'sd'|'se'|'sg'|'si'|'sk'|'sl'|'sm'|'sn'|'so'|'sq'|'sr'|'ss'|'st'|'su'|'sv'|'sw'|'ta'|'te'|'tg'|'th'|'ti'|'tk'|'tl'|'tn'|'to'|'tr'|'ts'|'tt'|'tw'|'ty'|'ug'|'uk'|'ur'|'uz'|'ve'|'vi'|'vo'|'wa'|'wo'|'xh'|'yi'|'yo'|'za'|'zh'|'zu'} ISOLangCode An ISO 639-1 language code.
 */

/**
 * Class used to handle interpretation and use of language files. 
 * Please load the LanguageHandler before any other handlers to 
 * ensure other handlers have access to the loaclised versions of 
 * any text they require. Any errors thrown from the LanguageHandler 
 * will be in English, as they cannot be localised.
 */
class LanguageHandler {
    /**
     * Array containing absolute paths to language files.
     * @type {String[]}
     * @private
     * @static
     */
    static #languageFiles = [];
    /**
     * Collection containing all language data.
     * @type {Collection&lt;String, Language>}
     * @private
     * @static
     */
    static #languages = new Collection();

    /**
     * ISO Language Code of the language to default to in cases in 
     * which the correct language to use cannot be determined.
     * @type {ISOLangCode}
     * @static
     */
    static defaultLanguage = "";
    
    /**
     * Add a folder to scan for language files when language files are loaded.
     * @param {String} languageFolder The absolute path to the folder containing language files.
     * @static
     * @example
     * // Add "src/lang" to the list of folders to scan
     * 
     * const { join } = require("path");
     * 
     * LanguageHandler.addLanguageFolder(join(__dirname, "src", "lang"));
     */
    static addLanguageFolder(languageFolder) {
        // check if then normalised path is absolute
        if (!isAbsolute(normalize(languageFolder))) throw new Error("Only absolute paths can be set as language folders.");
        // check the folder exists
        if (!existsSync(normalize(languageFolder))) throw new Error("That path does not exist.");
        // check that the folder is indeed a folder
        if (!statSync(normalize(languageFolder)).isDirectory()) throw new Error("This function expects a folder path, not a file path.")
        // scan for language files
        readdirSync(normalize(languageFolder)).forEach(name => {
            // ignore folders
            if (statSync(join(normalize(languageFolder), name)).isDirectory()) return;
            // ignore other files
            if (!/.lang$/g.test(name)) return;
            // add the file to the list of language files
            LanguageHandler.#languageFiles.push(join(normalize(languageFolder), name));
        });
    }

    /**
     * Clear any languages currently loaded and load all languages currently set to be used.
     * @param {import("winston").Logger=} logger The logger being used (to report errors with language files).
     * @static
     * @example
     * // Load all languages in src/lang
     * 
     * const { join } = require("path");
     * 
     * LanguageHandler.addLanguageFolder(join(__dirname, "src", "lang"));
     * LanguageHandler.loadAllLanguages();
     */
    static loadAllLanguages(logger) {
        // unload all language data
        LanguageHandler.#languages = new Collection();
        // load all languages
        LanguageHandler.#languageFiles.forEach(path => {
            try {
                LanguageHandler.loadLanguageFile(path);
            } catch (e) {
                if (logger) logger.error(e);
                else console.error(e);
            }
        });
    }

    /**
     * Load an individual language file.
     * @param {String} filepath The path to the file to load.
     * @static
     * @example
     * // Load the default "en.lang" language file
     * 
     * const { join } = require("path");
     * 
     * LanguageHandler.loadLanguageFile(join(__dirname, "lang", "en.lang"));
     */
    static loadLanguageFile(filepath) {
        // check if the path is absolute
        if (!isAbsolute(normalize(filepath))) throw new Error("Please provide an absolute path.");
        // check the file exists
        if (!existsSync(normalize(filepath))) throw new Error("That path does not exist.");
        // check that the path isn't a directory
        if (statSync(normalize(filepath)).isDirectory()) throw new Error("That path leads to a directory.");
        // get file contents
        let content = readFileSync(filepath, "utf-8");
        let lines = content.split("\n");
        // create the empty language object
        let language = {};
        lines.forEach(line => {
            // ignore comments
            if (line.indexOf("#") == 0 || line.indexOf("-") == 0) return;
            // ensure the line has an entry
            if (line.indexOf("=") == -1) return;
            // get the identifier
            let separated = line.split("=");
            let identifier = separated.shift().trim();
            // get the value
            let value = separated.join("=");
            // add characters such as \n and \t
            value = value.replace(/(?&lt;!\\)\\n/g, "\n").replace(/(?&lt;!\\)\\t/g, "\t");
            // remove \r cause it breaks stuff
            value = value.replace(/\r/g, "");
            // create entry in language object
            let lastLevel = language;
            // for each element of the identifier
            identifier.split(".").forEach((x, i, a) => {
                // if an element is undefined, create it
                if (!lastLevel[x]) lastLevel[x] = {};
                // if this is the last element, set it to the text
                if (i == a.length - 1) lastLevel[x] = value;
                // go a level deeper for the next element
                lastLevel = lastLevel[x];
            });
        });
        // add the language to the languages collection
        LanguageHandler.#languages.set(basename(normalize(filepath), extname(normalize(filepath))), language);
    }

    /**
     * Get localised text.
     * @param {ISOLangCode} locale The ISO language code of the locale to use.
     * @param {String[]} path An array containing the path to the localisation.
     * @param  {...String=} replace Items to place within the localised text.
     * @returns {String} The localised text.
     * @static
     * @example
     * // Get a localised logging level name
     * 
     * let name = LanguageHandler.getLocalisation("en", ["console", "logging", "debug"]);
     */
    static getLocalisation(locale, path, ...replace) {
        // if no locale provided use the default
        if (!locale) locale = LanguageHandler.defaultLanguage;
        // ensure locale is loaded
        if (!LanguageHandler.#languages.get(locale)) return path.join(".");
        // get the translation
        let nextElement = LanguageHandler.#languages.get(locale);
        path.forEach(x => nextElement = nextElement?.[x]);
        // return a fallback if no translation is found
        if (!nextElement) nextElement = path.join(".");
        // check the found translation is actually a string
        if (!typeof(nextElement) == "string") throw new Error(`The translation of '${path.join(".")}' in locale '${locale} is not a string.'`);
        // replace elements in the translation
        replace.forEach((x, i) => nextElement = nextElement.replace(new RegExp(`\\\$\\\{${i}\\\}`, "g"), x));
        // return the final result
        return nextElement;
    }
}

module.exports = LanguageHandler;</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"CommandHandler","link":"<a href=\"CommandHandler.html\">CommandHandler</a>"},{"title":"CommandHandler.addCommandDirectory","link":"<a href=\"CommandHandler.html#.addCommandDirectory\">CommandHandler &rtrif; addCommandDirectory</a>"},{"title":"CommandHandler.attachClient","link":"<a href=\"CommandHandler.html#.attachClient\">CommandHandler &rtrif; attachClient</a>"},{"title":"CommandHandler.removeCommandDirectory","link":"<a href=\"CommandHandler.html#.removeCommandDirectory\">CommandHandler &rtrif; removeCommandDirectory</a>"},{"title":"LanguageHandler","link":"<a href=\"LanguageHandler.html\">LanguageHandler</a>"},{"title":"LanguageHandler.addLanguageFolder","link":"<a href=\"LanguageHandler.html#.addLanguageFolder\">LanguageHandler &rtrif; addLanguageFolder</a>"},{"title":"LanguageHandler.getLocalisation","link":"<a href=\"LanguageHandler.html#.getLocalisation\">LanguageHandler &rtrif; getLocalisation</a>"},{"title":"LanguageHandler.loadAllLanguages","link":"<a href=\"LanguageHandler.html#.loadAllLanguages\">LanguageHandler &rtrif; loadAllLanguages</a>"},{"title":"LanguageHandler.loadLanguageFile","link":"<a href=\"LanguageHandler.html#.loadLanguageFile\">LanguageHandler &rtrif; loadLanguageFile</a>"},{"title":"LoggingHandler","link":"<a href=\"LoggingHandler.html\">LoggingHandler</a>"},{"title":"LoggingHandler.createLogger","link":"<a href=\"LoggingHandler.html#.createLogger\">LoggingHandler &rtrif; createLogger</a>"},{"title":"ISOLangCode","link":"<a href=\"global.html#ISOLangCode\">ISOLangCode</a>"},{"title":"Language","link":"<a href=\"global.html#Language\">Language</a>"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    

    

    


  </body>

</html>
